//
//  ViewController.h
//  PenTestExtension
//
//  Created by Luidia on 2018. 05. 04..
//  Copyright © 2018년 Luidia. All rights reserved.
//

#import <UIKit/UIKit.h>
#import "Toast+UIView.h"
#import "DrawViewController.h"
#import "MarkerCalibrationViewController.h"
#import "PenCalibrationViewController.h"
#import "BTNameChangeViewController.h"
#import "PNFPenLibExtension.h"

#include <sys/types.h>
#include <sys/sysctl.h>

#import <CoreBluetooth/CoreBluetooth.h>

#import "BLESearchListViewController.h"

#import <AudioToolbox/AudioToolbox.h>
#import <AVFoundation/AVFoundation.h>

#define AUDIO_DEV_MAX   255
#define AUDIO_USR_MAX   215

@class PNFPenLibExtension;

@interface ViewController : UIViewController <UITableViewDataSource, UITableViewDelegate, PenCalibrationViewControllerDelegate, MarkerCalibrationViewControllerDelegate, BTNameChangeViewControllerDelegate, DrawViewControllerDelegate, BLESearchListViewControllerDelegate>
{
    PNFPenLibExtension *penController;
    
    IBOutlet UITableView *mTableView;
    NSMutableArray* sections;
    NSMutableDictionary* items;
    
    IBOutlet UITextView *debugTextView;
    
    // H/W Info
    int status;
    CGPoint rawPt;
    CGPoint convPt;
    int pressure;
    int temperature;
    int aliveSec;
    
    // Smartmarker
    NSString* position;
    int smFlag;
    NSString* smProperties;
    
    // Battery
    int battery[2];
    
    // Count
    int downCnt;
    int moveCnt;
    int upCnt;
    
    // Packet
    int errCntX;
    int errCntY;
    int packetCnt;
    
    BOOL m_penConntectedStatus;
    int temperatureCnt;
    int penErrorCnt;
    
    NSThread* readThread;
    BOOL      readThreadPause;
    BOOL      readThreadStop;
    
    DrawViewController* drawViewController;
    UIColor* penColor;
    
    BLESearchListViewController* bleSearchController;
    
    int savePacketIndex;
    SystemSoundID alertSound;
    
    int RSSIValue;
}
@property (retain) BLESearchListViewController* bleSearchController;
@property (retain) PNFPenLibExtension *penController;
@property (retain) NSMutableArray* sections;
@property (retain) NSMutableDictionary* items;
@property (retain) DrawViewController* drawViewController;
@property (retain) NSString* position;
@property (retain) NSString* smProperties;
@property (retain) UIColor* penColor;

@property (readwrite) int status;
@property (readwrite) CGPoint rawPt;
@property (readwrite) CGPoint convPt;
@property (readwrite) int pressure;
@property (readwrite) int temperature;
@property (readwrite) int smFlag;
@property (readwrite) int aliveSec;
@property (readwrite) int RSSIValue;

- (IBAction)clearLog:(id)sender;
- (IBAction)calibrationClicked:(id)sender;
- (IBAction)drawingClicked:(id)sender;
- (IBAction)stopPenClicked:(id)sender;
- (IBAction)reStartPenClicked:(id)sender;

-(void) FreeLogMsg:(NSNotification *) note;
-(void) PenCallBackFunc:(NSNotification *)call;
-(void) addDebugText:(NSString*)text;
-(void) PenHandlerWithArgs:(CGPoint) Arg_ptRaw ptConv:(CGPoint) Arg_ptConv PenStatus:(int) Arg_PenStatus
               Temperature:(int) Arg_Temperature ModelCode:(int) Arg_modelCode
                SMPenFlag :(int) Arg_SMPenFlag SMPenState:(int) Arg_SMPenState
                  Pressure:(int) Arg_pressure PacketIndex:(int) Arg_PacketIndex;

@end
