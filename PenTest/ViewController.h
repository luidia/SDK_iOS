//
//  ViewController.h
//  iPhoneTest
//
//  Created by choi on 13. 2. 18..
//  Copyright (c) 2013ë…„ choi. All rights reserved.
//

#import <UIKit/UIKit.h>
#import "CalibViewController.h"
#import "Calib9ViewController.h"
#import "Toast+UIView.h"
#import "DrawViewController.h"
#import "TimeTestViewController.h"
#import "EquilCalibrationViewController.h"

#include <sys/types.h>
#include <sys/sysctl.h>

#define AUDIO_DEV_MAX   255
#define AUDIO_USR_MAX   215

@class PNFPenController;

@interface ViewController : UIViewController <CalibViewControllerDelegate, Calib9ViewControllerDelegate, UITableViewDataSource, UITableViewDelegate, EquilCalibrationViewControllerDelegate>
{
    PNFPenController *penController;
    
    IBOutlet UITableView *mTableView;
    NSMutableArray* sections;
    NSMutableDictionary* items;
    
    IBOutlet UITextView *debugTextView;
    IBOutlet UIButton *leftDeviceBtn;
    IBOutlet UIButton *rightDeviceBtn;
    IBOutlet UILabel *positionLabel;
    
    // H/W Info
    int status;
    CGPoint rawPt;
    CGPoint convPt;
    int pressure;
    int temperature;
    int aliveSec;
    
    // Smartmarker
    NSString* position;
    int smFlag;
    NSString* smProperties;
    
    // Battery
    int battery[2];
    
    // Count
    int downCnt;
    int moveCnt;
    int upCnt;
    
    // Packet
    int errCntX;
    int errCntY;
    int packetCnt;
    
    BOOL m_penConntectedStatus;
    int temperatureCnt;
    int penErrorCnt;
    float beforeRawX;
    float beforeRawY;
    int btPosition;
    
    NSTimer* penSleepCheckTimer;
    long savePenSleepRemainingTime;
    int savePenAliveSec;
    BOOL isRecvEnvDataFirst;
    BOOL isFirstPenSleepOldDevice;
    UIAlertView* penSleepView;
    
    NSThread* readThread;
    BOOL      readThreadPause;
    BOOL      readThreadStop;
    
    DrawViewController* drawViewController;
    enum CalibrationSize curCalibrationSize;
    CGRect curCalibrationRect;
    UIColor* penColor;
}
@property (retain) PNFPenController *penController;
@property (retain) UIAlertView* penSleepView;
@property (retain) NSMutableArray* sections;
@property (retain) NSMutableDictionary* items;
@property (retain) DrawViewController* drawViewController;
@property (retain) NSString* position;
@property (retain) NSString* smProperties;
@property (retain) UIColor* penColor;

@property (readwrite) int status;
@property (readwrite) CGPoint rawPt;
@property (readwrite) CGPoint convPt;
@property (readwrite) int pressure;
@property (readwrite) int temperature;
@property (readwrite) int smFlag;
@property (readwrite) int aliveSec;
@property (readwrite) enum CalibrationSize curCalibrationSize;
@property (readwrite) CGRect curCalibrationRect;

- (IBAction)clearLog:(id)sender;
- (IBAction)calibrationClicked:(id)sender;
- (IBAction)leftDeviceClicked:(id)sender;
- (IBAction)rightDeviceClicked:(id)sender;
- (IBAction)drawingClicked:(id)sender;
- (IBAction)stopPenClicked:(id)sender;
- (IBAction)reStartPenClicked:(id)sender;

-(void) FreeLogMsg:(NSNotification *) note;
-(void) PenCallBackFunc:(NSNotification *)call;
-(void) addDebugText:(NSString*)text;
-(void) PenHandlerWithArgs:(CGPoint) Arg_ptRaw ptConv:(CGPoint) Arg_ptConv PenStatus:(int) Arg_PenStatus
               Temperature:(int) Arg_Temperature ModelCode:(int) Arg_modelCode
                SMPenFlag :(int) Arg_SMPenFlag SMPenState:(int) Arg_SMPenState
                  Pressure:(int) Arg_pressure;
-(void) lazyCheckCalibration;
@end
